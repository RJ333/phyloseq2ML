---
title: "Phyloseq2ML vignette"
author: "René Janßen"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
    number_sections: true
vignette: >
  %\VignetteIndexEntry{Phyloseq2ML-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(phyloseq2ML)
library(phyloseq)
```

# Before starting

You can also go directly to [Let's start](Prepare_phyloseq_for_Machine_Learning.html)

## Vignette organization

This vignette part serves as link between the different sections and lays out 
some prerequisites.

First look how to [prepare your data](Prepare_phyloseq_for_Machine_Learning.html)
coming from a phyloseq object for Machine Learning.

We then go into the Random Forest specific part of the workflow running a
[Ranger classification](Ranger_classification.html).

Complementary to that, I will explain how to run a classification with keras
[here](Keras_classification.html). Please note that re-used functions explained
in one of the vignettes above will not be explained again in detail.

I furthermore added some code examples on how to run both multiclass 
classification and regression with [ranger](Ranger_regression.html) and 
[keras](Keras_regression_multiclass.html). As this only requires minimal 
adjustments, comments are kept to a minimum.

## Background
If you are completely new to Machine Learning (ML) or even to R at all, you 
might want to do some reading first (you probably already have), such as 
[10 tips for machine learning with biological data](https://biodatamining.biomedcentral.com/articles/10.1186/s13040-017-0155-3). You should know what supervised machine learning is and at least roughly how Random 
Forests work. Check out this [youtube channel](https://www.youtube.com/results?search_query=statquest+random+forest) 
for the best statistics and machine learning videos I've seen (there a lot of 
bad ones online!). Double Bam! 

And for neural networks: my keras code is mostly based on this book 
[Deep Learning with R](https://www.manning.com/books/deep-learning-with-r). 
But I also included a lot of (very shallow) explanations along the way to give
you the key words for easier recherche.

If you know your way around R, you should have a look at packages like `caret`,
`parsnip` etc which try to provide a standardized interface to various machine 
learning and other regression methods. 

## Purpose of this package

In short: be able to use or test machine learning (currently Random Forest and 
Neural Networks) with microbiome data and corresponding environmental data.

How: By providing some functions that make use of phyloseqs standard data 
format. Phyloseq is the starting point as you can basically get all kinds of 
data into phyloseq format.

Additional: Providing wrappers to actual run ML using this package and get 
results with metrics. Maybe some more functions to look into the results. This 
is especially for not-hardcore users, who probably want to specify their own ML 
approaches. Using this package, the data is ready to go for that.

## What does the package contain

* Phyloseq object modification
* Data preparation for binary and multi-class classification and regression
* Generating a list of input data frames for ML
* Running the full list and getting results with metrics for Random Forest and 
Artificial Neural Networks

## Why are these specific methods implemented?

For historical reasons. I used Random Forest and Artificial Neurals Networks in 
my first [research paper](https://www.researchgate.net/publication/336917275_An_artificial_neural_network_and_Random_Forest_identify_glyphosate-_impacted_brackish_communities_based_on_16S_rRNA_amplicon_MiSeq_read_counts) based on a lab experiment. We were now curious to see how the same methods perform in a real world setting. As this 
package mainly is a way of distributing the code that I use for my current work, 
these are the supported methods at the moment.

## What does this packge require?

* obviously `phyloseq`, `ranger` and `keras` with `tensorflow` as backend
* also using `data.table` for the oversampling function
* logging (printing messages) via `futile.logger`, you can set the information 
urgency threshold
* `purrr` and `tidyr` are used for the ML wrapper functions. 
* `ggplot2` for plotting
* `fastDummies` is used to turn factor columns into integer dummy columns
* There is a package called `speedyseq` available on github, you can install it 
using:

```r
devtools::install_github("mikemc/speedyseq")
```
It replaces a couple of phyloseq included functions with a faster version. For 
this package, we are only interested in a faster version of `tax_glom`, but as 
a phyloseq user, having a quicker `psmelt` function might be even more 
interesting.

## Future vignette plans

* Add a data augmentation step and evaluate results using unsupervised Random 
Forests
* Use set.seed to run Random Forest and Neural networks with identically 
splitted input data and directly compare the results
* Use some phyloseq included data sets for demonstration
* Show how to modify the `purrr:pmap`-called `ranger_*` and `keras_*` functions 
to your needs
* Include variable importance analysis for ranger results
* Calculate p values for your models

## Future package plans

If I find some time I would like to test and include gradient boosting
